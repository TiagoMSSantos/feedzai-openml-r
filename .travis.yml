sudo: yes

services:
  - docker

language: java

# Travis is configured to run on pushed branches and pull requests so if we don't filter branches it runs twice when
# we push the PR branch in our repo
branches:
  only:
    - master
    #tag xx.yy-zz or xx.yy.zz-anythinglikeexperimental
    - /^\d+\.\d+(\.\d+)?(-\S*)?$/
    #hotfix branches (not being too strict on purpose)
    - /^hf-.*$/
    
before_install:
  - docker pull feedzai/rserve-caret:1.0.0
  - docker run -v $(pwd):/opt/openml -d --name test-container feedzai/rserve-caret:1.0.0

install:
  - docker exec -it test-container mvn install -f /opt/openml/pom.xml -DskipTests=true -Dmaven.javadoc.skip=true -B -V

script:
  - docker exec -it test-container mvn -f /opt/openml/pom.xml test

after_success:
  - bash <(curl -s https://codecov.io/bash)

notifications:
    # enables comments in the branch with the CI results
    webhooks: https://www.travisbuddy.com/

deploy:
  provider: script
  script: deploy/deploy.sh
  on:
    tags: true
